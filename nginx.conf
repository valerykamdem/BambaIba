
events {}

http {
    # Limite les attaques
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

    server {
        listen 80;
        server_name _;

        # Redirection HTTPS
        return 301 https://$host$request_uri;
    }

    server {
        listen 443 ssl;
        server_name _;

        ssl_certificate /etc/nginx/certs/fullchain.pem;
        ssl_certificate_key /etc/nginx/certs/privkey.pem;

        ## Proxy vers ton API .NET
        # location /api/ {
         #  limit_req zone=api_limit burst=20;
            # proxy_pass http://bambaiba_api:80;
            # proxy_set_header Host $host;
            # proxy_set_header X-Real-IP $remote_addr;
        # }

        # Proxy vers SeaweedFS S3 (sécurisé)
        location /s3/ {
            rewrite ^/s3/(.*)$ /$1 break;
            proxy_pass http://seaweed_s3:8333;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
        }

        # Proxy vers le filer (optionnel)
        location /filer/ {
            rewrite ^/filer/(.*)$ /$1 break;
            proxy_pass http://filer:8888;
            proxy_set_header Host $host;
        }
    }
}
